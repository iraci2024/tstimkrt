<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>sgcWebSockets - Protocol: files.esegece.com</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name = "viewport" content = "width = 320, initial-scale = 1.0, user-scalable = yes"> 
<script type="text/javascript" src="http{%ssl%}://{%host%}:{%port%}/sgcWebSockets.js"></script>
<script type="text/javascript" src="http{%ssl%}://{%host%}:{%port%}/files.esegece.com.js"></script>
<style>
body {
	font-family:Verdana,Arial,"Times New Roman";
}

#status {
  padding: 5px;
  color: #fff;
  background: #ccc;
}
#status.error {
  background: #c00;
  font-weight: bold;
}
#status.offline {
  background: #c00;
  font-weight: bold;
}
#status.online {
  background: #0c0;
  font-weight: bold;
}
</style>
</head>
<body>
<h1>sgcWebSockets</h1>
<h3>files.esegece.com</h3>
<table width="100%">
	<tr>
		<td>
			Status
		</td>
		<td>
			<p id="status"></p>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<h3>WebSocket Methods</h3>
		</td>
	</tr>
	<tr>
		<h2>File Upload</h2>
			Select file
		<input type="file" id="filename" /><br>
		<input type="button" value="Upload" onclick="sendFile()" />	
	</tr>
	<tr>
		<td>
			<a href="
			javascript:var socket = new sgcws_files('ws{%ssl%}://{%host%}:{%port%}'); 

			socket.on('open', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#connected</b></li>' + document.getElementById('log').innerHTML;
					document.getElementById('status').innerHTML = 'Socket Open';
					document.getElementById('status').className = 'online';
				}
			);
			socket.on('close', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#disconnected:' + event.clean + '</b></li>' + document.getElementById('log').innerHTML;
					document.getElementById('status').innerHTML = 'Socket Closed';
					document.getElementById('status').className = 'offline';
				}
			);
			socket.on('sgcmessage', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#received:' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);
			socket.on('sgcevent', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#event:' + event.channel + ' - ' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);			
			socket.on('sgcsubscribe', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#subscribed:' + event.channel + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);
			socket.on('sgcunsubscribe', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#unsubscribed:' + event.channel + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);
			socket.on('sgcrpcresult', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#rpc-result:' + event.result + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);			
			socket.on('sgcrpcerror', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#rpc-error:' + event.code + ' ' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);			
			socket.on('sgcacknowledgment', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#rpc-acknowledgment:' + event.id + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);		
			socket.on('sgcpubrec', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#pubrec:' + event.id + '</b></li>' + document.getElementById('log').innerHTML;
					socket.pubrel(event.id);
				}
			);			
			socket.on('sgcsession', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#session:' + event.guid + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);	
			socket.on('error', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#disconnected:' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
					document.getElementById('status').innerHTML = 'Socket Error';
					document.getElementById('status').className = 'error';
				}
			);
			socket.on('sgcfilesentacknowledgment', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#filesentacknowledgment: ' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);	
			socket.on('sgcfilesent', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#filesent: ' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);	
			socket.on('sgcfilesenterror', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#filesenterror: ' + event.error + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);		
			socket.on('sgcfilereceivedauthorization', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#filereceivedauthorization: ' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);	
			socket.on('sgcfilereceived', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#filereceived: ' + event.message + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);	
			socket.on('sgcfilereceivederror', function(event)
				{  
					document.getElementById('log').innerHTML = '<li><b>#filereceivederror: ' + event.error + '</b></li>' + document.getElementById('log').innerHTML;
				}
			);			
			function sendFile() {
              var file = document.getElementById('filename').files[0];
              var reader = new FileReader();
			  var rawData = new ArrayBuffer(); 

              reader.loadend = function() {
              };

              reader.onload = function(e) {
                rawData = e.target.result;
				socket.qoslevel1();
                socket.sendfile(rawData, file.name);
              };
              reader.readAsArrayBuffer(file);
            };			
			">Open</a>	
		</td>
		<td>
			Open WebSocket Connection.	
		</td>
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.close();">Close</a>
		</td>
		<td>
			Closes WebSocket Connection.
		</td>		
	</tr>
	<tr>
		<td>
			<a href="javascript:document.getElementById('log').innerHTML = '<li><b>#status:' + socket.state() + '</b></li>' + document.getElementById('log').innerHTML;
			">Status</a>
		</td>
		<td>
			Get Status WebSocket Connection.
		</td>
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.starttransaction();">Start Transaction</a>
		</td>
		<td>
			Starts a New Transaction.
		</td>		
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.commit();">Commit</a>
		</td>
		<td>
			Commit Messages.
		</td>		
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.rollback;">RollBack</a>
		</td>
		<td>
			RollBack Messages.
		</td>		
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.send('Hello Server!');">Send</a>
		</td>
		<td>
			Send Message to Server.
		</td>		
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.broadcast('Hello sgcWebSockets!');">Broadcast</a>
		</td>
		<td>
			Broadcast Message to all Connected Clients;
		</td>		
	</tr>	
	<tr>
		<td>
			<a href="javascript:socket.subscribe('test');">Subscribe</a>
		</td>
		<td>
			Subscribe to Channel Test.
		</td>		
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.unsubscribe('test');">UnSubscribe</a>
		</td>
		<td>
			UnSubscribe to Channel Test.
		</td>		
	</tr>
	<tr>
		<td>
			<a href="javascript:socket.publish('Hello Subscribers!', 'test');">Publish</a>
		</td>
		<td>
			Publish Message to Test Subscribed Clients;
		</td>		
	</tr>	
	<tr>
		<td>
			<a href="javascript: var params = {param:10}; socket.rpc(GUID(), 'test', JSON.stringify(params));">RPC</a>
		</td>
		<td>
			Call test RPC.
		</td>		
	</tr>	
	<tr>
		<td>
			<a href="javascript: var params = {param:10}; socket.notify('test', JSON.stringify(params));">Notify</a>
		</td>
		<td>
			Notify Test.
		</td>		
	</tr>	
		<tr>
		<td>
			<a href="javascript: socket.getsession();">Get Session</a>
		</td>
		<td>
			Get Session from Server.
		</td>		
	</tr>
	<tr>
		<td colspan="2">
			<h3>Log</h3>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<ul id="log" style="overflow: auto; list-style: none; padding:0; background:#ffffff; font-size:small; border-style:solid; border-color:#c0c0c0"></ul>
		</td>
	</tr>	
</table>

</body>
</html>


