/*!
**************************************************************************
 sgcWebSocket component

 written by eSeGeCe
            copyright Â© 2021
            Email : info@esegece.com
            Web : http://www.esegece.com
**************************************************************************
*/

function sgcws_dataset(){if(0!=arguments.length){1==arguments.length?"object"==typeof arguments[0]?(arguments[0].subprotocol="dataset.esegece.com",sgcWebSocket.call(this,arguments[0])):"string"==typeof arguments[0]&&(arguments[1]="dataset.esegece.com",sgcWebSocket.call(this,arguments[0],arguments[1])):2==arguments.length?"object"==typeof arguments[0]?(arguments[0].subprotocol=arguments[1]+".dataset.esegece.com",sgcWebSocket.call(this,arguments[0])):"string"==typeof arguments[0]&&(arguments[1]=arguments[1]+".dataset.esegece.com",sgcWebSocket.call(this,arguments[0],arguments[1])):3==arguments.length&&("object"==typeof arguments[0]?(arguments[0].subprotocol=arguments[1]+".dataset.esegece.com",arguments[0].transport=arguments[2],sgcWebSocket.call(this,arguments[0])):"string"==typeof arguments[0]&&(arguments[1]=arguments[1]+".dataset.esegece.com",sgcWebSocket.call(this,arguments[0],arguments[1],arguments[2])));var e="";this.qoslevel0=function(){e="qosLevel0"},this.qoslevel1=function(){e="qosLevel1"},this.qoslevel2=function(){e="qosLevel2"};var s="";this.queuelevel0=function(){s="queueLevel0"},this.queuelevel1=function(){s="queueLevel1"},this.queuelevel2=function(){s="queueLevel2"};var t=this.send;this.send=function(n,c,a,o){_qos="",""!==e&&void 0!==e&&(_qos=', "qos":"'+e+'"'),_queue="",""!==s&&void 0!==s&&"sgc@publish"==c&&(_queue=', "queue":"'+s+'"'),_message=n,"{"!==_message.substr(0,1)&&"["!==_message.substr(0,1)&&'"'!==_message.substr(0,1)&&(_message='"'+_message+'"'),1==arguments.length?arguments[0]='{"jsonrpc":"2.0", "method":"sgc@message", "params":{"message":'+_message+_qos+_queue+'}, "id":"'+GUID()+'"}':2==arguments.length?arguments[0]='{"jsonrpc":"2.0", "method":"'+c+'", "params":{"message":'+_message+_qos+_queue+'}, "id":"'+GUID()+'"}':""!==o&&void 0!==o?arguments[0]='{"jsonrpc":"2.0", "method":"'+c+'", "params":{"channel":"'+a+'", "message":'+_message+_qos+_queue+'}, "id":"'+o+'"}':arguments[0]='{"jsonrpc":"2.0", "method":"'+c+'", "params":{"channel":"'+a+'", "message":'+_message+"}}",t.apply(this,arguments)},this.broadcast=function(){1==arguments.length?this.send(arguments[0],"sgc@broadcast",""):2==arguments.length&&this.send(arguments[0],"sgc@broadcast",arguments[1])},this.dataset=function(e,s){arguments[0]='{"jsonrpc":"2.0", "result":{"method":"sgc@dataset","channel":"sgc@dataset@'+e+'","dataset":'+s+"}}",t.apply(this,arguments)},this.dataset_new=function(e){this.dataset("new",e)},this.dataset_update=function(e){this.dataset("update",e)},this.dataset_delete=function(e){this.dataset("delete",e)},this.request=function(e){arguments[0]='{"jsonrpc":"2.0", "method":"'+e+'"}',t.apply(this,arguments)},this.synchronize=function(){this.request("sgc@dataset@req@records")},this.getmetadata=function(){this.request("sgc@dataset@req@metadata")},this.getsession=function(){this.request("sgc@session")},this.starttransaction=function(e){void 0==e&&(e=""),this.send("","sgc@transaction",e,"")},this.commit=function(e){void 0==e&&(e=""),this.send("","sgc@commit",e,"")},this.rollback=function(e){void 0==e&&(e=""),this.send("","sgc@rollback",e,"")},this.publish=function(){this.send(arguments[0],"sgc@publish",arguments[1],GUID())},this.rpc=function(e,s,n){arguments[0]='{"jsonrpc":"2.0", "method":"'+s+'", "params":'+n+', "id":"'+e+'"}',t.apply(this,arguments)},this.notify=function(e,s){arguments[0]='{"jsonrpc":"2.0", "method":"'+e+'", "params":'+s+'"}',t.apply(this,arguments)},this.subscribe=function(e){this.send("","sgc@subscribe",e,GUID())},this.unsubscribe=function(e){this.send("","sgc@unsubscribe",e,GUID())},this.subscribe_all=function(){this.subscribe("sgc@dataset@new"),this.subscribe("sgc@dataset@update"),this.subscribe("sgc@dataset@delete")},this.unsubscribe_all=function(){this.unsubscribe("sgc@dataset@new"),this.unsubscribe("sgc@dataset@update"),this.unsubscribe("sgc@dataset@delete")},this.pubrel=function(e){this.send("","sgc@pubrel","",e)};var n=new event("onsgcmessage"),c=new event("onsgcsubscribe"),a=new event("onsgcunsubscribe"),o=new event("onsgcdataset"),r=new event("onsgcevent"),i=new event("onsgcrpcresult"),u=new event("onsgcrpcerror"),g=new event("onsgcacknowledgment"),b=new event("onsgcpubrec"),d=new event("onsgcsession"),h=new event("onsgcmetadata"),l=new event("onsgcbeforesynchronize"),m=new event("onsgcaftersynchronize");DoEventMessage=function(e){var s=e.data;obj=JSON.parse(s),void 0!==obj.result?"sgc@subscribe"==obj.result.method?c.fire({name:"onsgcsubscribe",channel:obj.result.channel}):"sgc@unsubscribe"==obj.result.method?a.fire({name:"onsgcunsubscribe",channel:obj.result.channel}):"sgc@pubrec"==obj.result.method?b.fire({name:"onsgcpubrec",id:obj.id}):"sgc@event"==obj.result.method?r.fire({name:"onsgcevent",channel:obj.result.channel,message:obj.result.message}):"sgc@session"==obj.result.method?d.fire({name:"onsgcsession",guid:obj.result.message}):"sgc@dataset"==obj.result.method?o.fire({name:"onsgcdataset",channel:obj.result.channel,dataset:obj.result.dataset}):"sgc@metadata"==obj.result.method?h.fire({name:"onsgcmetadata",metadata:obj.result.metadata}):"sgc@message"==obj.result.method?n.fire({name:"onsgcmessage",message:obj.result.message}):"sgc@acknowledgment"==obj.result.method?g.fire({name:"onsgcacknowledgment",id:obj.result.id}):"sgc@dataset@req@records@start"==obj.result.method?l.fire({name:"onsgcbeforesynchronize",dataset_name:obj.result.dataset_name,dataset_recordcount:obj.result.dataset_recordcount}):"sgc@dataset@req@records@end"==obj.result.method?m.fire({name:"onsgcaftersynchronize",dataset_name:obj.result.dataset_name}):i.fire({name:"onsgcrpcresult",result:obj.result,id:obj.id}):void 0!==obj.error&&u.fire({name:"onsgcrpcerror",code:obj.error.code,message:obj.error.message,data:obj.error.data})};var p=this.on;this.on=function(e,s){"sgcdataset"==e?o.subscribe(s):"sgcmessage"==e?n.subscribe(s):"sgcevent"==e?r.subscribe(s):"sgcsession"==e?d.subscribe(s):"sgcsubscribe"==e?c.subscribe(s):"sgcunsubscribe "==e?a.subscribe(s):"sgcacknowledgment"==e?g.subscribe(s):"sgcpubrec"==e?b.subscribe(s):"sgcbeforesynchronize"==e?l.subscribe(s):"sgcaftersynchronize"==e?m.subscribe(s):"sgcrpcresult"==e?i.subscribe(s):"sgcrpcerror"==e?u.subscribe(s):"sgcmetadata"==e?h.subscribe(s):p.apply(this,arguments)}}}sgcws_dataset.prototype=new sgcWebSocket,sgcws_dataset.prototype.constructor=sgcws_dataset;